/*!
*  filename: ej.pivot.common.min.js
*  version : 15.2.0.40
*  Copyright Syncfusion Inc. 2001 - 2017. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min"],n):n()})(function(){ej.Pivot=ej.Pivot||{},function(n,t,r){t.Pivot={addReportItem:function(n,i){if(i.isMeasuresDropped)i.droppedClass!=""?n.values[0].axis=i.droppedClass=="row"?"rows":i.droppedClass=="column"?"columns":n.values[0].axis:n.values[0].measures=[];else{var r=this.removeReportItem(n,i.droppedFieldName,i.isMeasuresDropped);t.isNullOrUndefined(r)&&(r={fieldName:i.droppedFieldName,fieldCaption:i.droppedFieldCaption});switch(i.droppedClass){case"row":i.droppedPosition.toString()!=""?n.rows.splice(i.droppedPosition,0,r):n.rows.push(r);break;case"column":i.droppedPosition.toString()!=""?n.columns.splice(i.droppedPosition,0,r):n.columns.push(r);break;case"value":n.cube==""?i.droppedPosition.toString()!=""?n.values.splice(i.droppedPosition,0,r):n.values.push(r):i.droppedPosition.toString()!=""?n.values[0].measures.splice(i.droppedPosition,0,r):n.values[0].measures.push(r);break;case"filter":i.droppedPosition.toString()!=""?n.filters.splice(i.droppedPosition,0,r):n.filters.push(r)}}},removeReportItem:function(i,r,u){var o=i.cube==""?t.Pivot.AnalysisMode.Pivot:t.Pivot.AnalysisMode.Olap,f=n.grep(i.columns,function(n){return n.fieldName==r}),e;return u?i.values[0].measures=[]:f.length>0?i.columns=n.grep(i.columns,function(n){return n.fieldName!=r}):(f=n.grep(i.rows,function(n){return n.fieldName==r}),f.length>0?i.rows=n.grep(i.rows,function(n){return n.fieldName!=r}):(e=o==t.Pivot.AnalysisMode.Olap?i.values[0].measures:i.values,f=n.grep(e,function(n){return n.fieldName==r}),f.length>0?i.values=o==t.Pivot.AnalysisMode.Olap?[{measures:n.grep(e,function(n){return n.fieldName!=r}),axis:i.values[0].axis}]:n.grep(e,function(n){return n.fieldName!=r}):(f=n.grep(i.filters,function(n){return n.fieldName==r}),f.length>0&&(i.filters=n.grep(i.filters,function(n){return n.fieldName!=r}))))),f[0]},getReportItemByFieldName:function(i,r){var f="columns",u=n.grep(r.columns,function(n){return n.fieldName.toLowerCase()==i.toLowerCase()}),e;return u.length==0&&(u=n.grep(r.rows,function(n){return n.fieldName.toLowerCase()==i.toLowerCase()}),f="rows"),u.length==0&&(e=r.cube==""?r.values:r.values.length>0&&!t.isNullOrUndefined(r.values[0].measures)?r.values[0].measures:[],u=n.grep(e,function(n){return n.fieldName.toLowerCase()==i.toLowerCase()}),f="values"),u.length==0&&(u=n.grep(r.filters,function(n){return n.fieldName.toLowerCase()==i.toLowerCase()}),f="filters"),{item:u[0],axis:f}},getReportItemByFieldCaption:function(i,r){var f="columns",u=n.grep(r.columns,function(n){return n.fieldCaption.toLowerCase()==i.toLowerCase()}),e;return u.length==0&&(u=n.grep(r.rows,function(n){return n.fieldCaption.toLowerCase()==i.toLowerCase()}),f="rows"),u.length==0&&(e=r.cube==""?r.values:r.values.length>0&&!t.isNullOrUndefined(r.values[0].measures)?r.values[0].measures:[],u=n.grep(e,function(n){return n.fieldCaption.toLowerCase()==i.toLowerCase()}),f="values"),u.length==0&&(u=n.grep(r.filters,function(n){return n.fieldCaption.toLowerCase()==i.toLowerCase()}),f="filters"),{item:u[0],axis:f}},closePreventPanel:function(n){var i=n.type!="close"?n:this;i.element.find("#preventDiv").remove();t.isNullOrUndefined(i.model.pivotControl)||i.model.pivotControl.element.find("#preventDiv").remove();t.isNullOrUndefined(i._waitingPopup)||i._waitingPopup.hide();t.isNullOrUndefined(i.model.pivotControl)||t.isNullOrUndefined(i.model.pivotControl._waitingPopup)||i.model.pivotControl._waitingPopup.hide()},openPreventPanel:function(i){var r=t.buildTag("div#preventDiv.errorDlg").css({width:n("body").width()+"px",height:n("body").height()+"px",position:"absolute",top:n("body").offset().top+"px",left:n("body").offset().left+"px","z-index":10})[0].outerHTML;n("#"+i._id).append(r)},_createErrorDialog:function(i,r,u){var e,o;if(t.Pivot.closePreventPanel(u),u._errorDialog=r,t.Pivot.openPreventPanel(u),u.element.find(".errorDialog:visible").length==0){e=t.isNullOrUndefined(i.Exception)?t.buildTag("div.errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent action:",i)[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn","OK",{margin:"20px 0 10px 165px"})[0].outerHTML)[0].outerHTML).attr("title",r)[0].outerHTML:t.buildTag("div.errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent action:",i.Exception.Message)[0].outerHTML+t.buildTag("br")[0].outerHTML+t.buildTag("div."+u._id+"stackTraceContent","Stack Trace :"+i.Exception.StackTraceString)[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn","OK",{margin:"20px 0 10px 165px"})[0].outerHTML)[0].outerHTML).attr("title",r)[0].outerHTML;u.element.append(e);u.element.find(".errorDialog").ejDialog({target:"#"+u._id,enableResize:!1,enableRTL:u.model.enableRTL,width:"400px",close:t.proxy(t.Pivot.closePreventPanel,u)});o=u.element.find(".errorDialog").data("ejDialog");n("#"+o._id+"_wrapper").css({left:"50%",top:"50%"});u.element.find(".errOKBtn").ejButton({type:t.ButtonType.Button,width:"50px"}).on(t.eventType.click,function(){u._errorDialog!="nodeCheck"||t.isNullOrUndefined(u._schemaData)||t.isNullOrUndefined(u._schemaData._selectedTreeNode)||u._schemaData._tableTreeObj.uncheckNode(u._schemaData._selectedTreeNode);u.element.find("#preventDiv").remove();(u._errorDialog=="Warning"||u._errorDialog=="Exception"||u._errorDialog=="Error")&&u.element.children("#ErrorDialog_wrapper").remove()});if(u.element.find(".e-dialog .e-close").attr("title","Close"),t.isNullOrUndefined(n("#"+u._id).data("ejWaitingPopup"))||n("#"+u._id).data("ejWaitingPopup").hide(),typeof oclientWaitingPopup!="undefined"&&oclientWaitingPopup!=null&&oclientWaitingPopup.hide(),!t.isNullOrUndefined(i.Exception)){var f=50,h="...",s="Show more",c="Show less";n("."+u._id+"stackTraceContent").each(function(){var i=n(this).html();if(i.length>f){u._id;var r=i.substr(0,f),e=i.substr(f,i.length-f),o=r+t.buildTag("span."+u._id+"moreellipses",h)[0].outerHTML+t.buildTag("span."+u._id+"morecontent",t.buildTag("span",e).css("display","none")[0].outerHTML+t.buildTag("a."+u._id+"morelink",s).css("display","block")[0].outerHTML)[0].outerHTML;n(this).html(o)}});n("."+u._id+"morelink").click(function(){return n(this).hasClass("less")?(n(this).removeClass("less"),n(this).html(s)):(n(this).addClass("less"),n(this).html(c)),n(this).parent().prev().toggle("slow",function(){}),n(this).prev().toggle("slow",function(){}),!1})}}},_contextMenuOpen:function(i,r){var f,e,u;if(t.Pivot.openPreventPanel(r),r._selectedMember=n(i.target),r.pluginName=="ejPivotGrid"?(f=r.model.analysisMode==t.Pivot.AnalysisMode.Olap?"olap":"pivot",u=n("#pivotTree").data("ejMenu")):(t.isNullOrUndefined(r.model.pivotControl)||(f=r.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?"olap":"pivot"),u=n("#pivotTreeContextMenu").data("ejMenu")),f==t.Pivot.AnalysisMode.Olap){if(t.isNullOrUndefined(n(i.target).parent().attr("tag"))&&n(i.target).hasClass("pivotButton")&&n(i.target).children(".pvtBtn:eq(0)").length>0)return r._selectedMember=n(i.target).children(".pvtBtn:eq(0)"),!1;n(i.target).parent().attr("tag").split(":")[1].toLowerCase().startsWith("[measures]")?u.disable():r._selectedMember.parent().attr("tag").split(":")[1].toLowerCase()=="measures"?(u.disableItem(r._getLocalizedLabels("AddToValues")),u.disableItem(r._getLocalizedLabels("AddToFilter")),u.enableItem(r._getLocalizedLabels("AddToRow")),u.enableItem(r._getLocalizedLabels("AddToColumn"))):(u.disableItem(r._getLocalizedLabels("AddToValues")),n(i.target.parentElement).find(".namedSetCDB").length>0?u.disableItem(r._getLocalizedLabels("AddToFilter")):u.enableItem(r._getLocalizedLabels("AddToFilter")),u.enableItem(r._getLocalizedLabels("AddToRow")),u.enableItem(r._getLocalizedLabels("AddToColumn")))}else f==t.Pivot.AnalysisMode.Pivot&&(e=i.target.textContent,n(i.target).hasClass("e-btn")?(u.enable(),r.pluginName=="ejPivotGrid"&&(u.disableItem(r._getLocalizedLabels("CalculatedField")),n(i.target).parents(".pivotButton").attr("tag").split(":")[0].toLowerCase()=="values"&&(r.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&n.grep(r.model.dataSource.values,function(n){return n.fieldCaption==e&&n.isCalculatedField==!0}).length>0?u.disable():r.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&n.grep(JSON.parse(r.getOlapReport()).PivotCalculations,function(n){return n.FieldHeader==e&&n.CalculationType==8}).length>0&&u.disable(),u.enableItem(r._getLocalizedLabels("CalculatedField"))))):(u=n("#pivotTree").data("ejMenu"),u.disable()))},_searchTreeNodes:function(i){var a=n(i.target).hasClass("searchTreeView")?this.element.find(".searchTreeView").data("ejMaskEdit"):this.element.find(".searchEditorTreeView").data("ejMaskEdit"),u=n(i.target).hasClass("searchTreeView")?this.model.operationalMode==t.Pivot.OperationalMode.ClientMode||this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this.element.find(".schemaFieldTree").data("ejTreeView"):this.element.find(".cubeTreeView").data("ejTreeView"):this.element.find(".editorTreeView").data("ejTreeView"),s=u.element,v=t.isNullOrUndefined(a.get_StrippedValue())?"":a.get_StrippedValue().toLowerCase(),f,e,c,o,l,r;if(v.length>0){var y=[],p=[],h=s.find("ul>li>div>a");for(f=0;f<h.length;f++)n(h[f]).text().toLowerCase().indexOf(v)!=-1?y.push(h[f]):p.push(h[f]);for(e=s.find(y).closest("li").css("display","block"),s.find(p).closest("li").css("display","none"),r=0;r<e.length;r++)c=n(e[r]),o=c.parents("ul").closest("li").css("display","block"),o.length>0&&(u.expandNode(o),u.model.expandedNodes.indexOf(n(u._liList).index(o))!=-1||t.isNullOrUndefined(window._temp)||window._temp.push(o)),l=c.children("ul"),l.length>0&&l.children("li:visible").length==0&&(c.children("ul").children("li").css("display","block"),u.expandNode(e[r]),u.model.expandedNodes.indexOf(n(u._liList).index(e[r]))!=-1||t.isNullOrUndefined(window._temp)||window._temp.push(e[r]))}else{if(s.find("ul>li").css("display","block"),!t.isNullOrUndefined(window._temp))for(r=0;r<window._temp.length;r++)u._collpaseNode(window._temp[r]);window._temp=[];n(i.target).hasClass("searchTreeView")&&u.collapseAll()}},editorTreeNavigatee:function(i,u){var o=u._memberPageSettings.currentMemeberPage,e,f;if(!n(i.target).hasClass("pageDisabled")){if(n(i.target).hasClass("nextPage"))u._memberPageSettings.startPage+=u.model.memberEditorPageSize,u._memberPageSettings.currentMemeberPage+=1,u._memberPageSettings.endPage+=u.model.memberEditorPageSize;else if(n(i.target).hasClass("prevPage"))u._memberPageSettings.currentMemeberPage-=1,u._memberPageSettings.startPage=Math.abs(u._memberPageSettings.startPage-(u._memberPageSettings.currentMemeberPage==1?u.model.memberEditorPageSize:u.model.memberEditorPageSize)),u._memberPageSettings.endPage-=u.model.memberEditorPageSize;else if(n(i.target).hasClass("firstPage"))u._memberPageSettings.currentMemeberPage=1,u._memberPageSettings.endPage=u.model.memberEditorPageSize,u._memberPageSettings.startPage=0;else if(n(i.target).hasClass("lastPage"))u._memberPageSettings.currentMemeberPage=parseInt(u.element.find(".memberPageCount").text().split("/")[1].trim()),u._memberPageSettings.endPage=u._memberPageSettings.currentMemeberPage*u.model.memberEditorPageSize,u._memberPageSettings.startPage=u._memberPageSettings.endPage-u.model.memberEditorPageSize;else{if(parseInt(n(i.target).val())>parseInt(t.isNullOrUndefined(u._pivotSchemaDesigner)?u.element.find(".memberPageCount").text().split("/")[1].trim():u._pivotSchemaDesigner.element.find(".memberPageCount").text().split("/")[1].trim())||parseInt(n(i.target).val())==0)return!1;u._memberPageSettings.currentMemeberPage=parseInt(n(i.target).val());u._memberPageSettings.endPage=u._memberPageSettings.currentMemeberPage*u.model.memberEditorPageSize;u._memberPageSettings.startPage=u._memberPageSettings.currentMemeberPage==1||u._memberPageSettings.currentMemeberPage==0?0:u._memberPageSettings.endPage-u.model.memberEditorPageSize}u._waitingPopup.show();u.model.operationalMode==t.Pivot.OperationalMode.ClientMode?(u._isMemberPageFilter=!0,e=t.Pivot.updateTreeView(u._pivotSchemaDesigner),f=t.DataManager(u._editorTreeData).executeLocal(t.Query().where("pid","equal",null||r).page(u._memberPageSettings.currentMemeberPage,u.model.memberEditorPageSize)),f.splice(0,0,{id:"All",name:"All",checkedStatus:u._isAllMemberChecked,tag:""}),u._pivotSchemaDesigner._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(f)})):(u._isSearchApplied=!1,this.editorTreePageInfoSuccess(u._editorTreeData,u))}},editorTreePageInfoSuccess:function(i,u){setTimeout(function(){u._memberPageSettings.currentMemeberPage>1?u.element.find(".prevPage, .firstPage").removeClass("pageDisabled").addClass("pageEnabled"):u.element.find(".prevPage, .firstPage").removeClass("pageEnabled").addClass("pageDisabled");u._memberPageSettings.currentMemeberPage==parseInt(u.element.find(".memberPageCount").text().split("/")[1].trim())?u.element.find(".nextPage, .lastPage").removeClass("pageEnabled").addClass("pageDisabled"):u.element.find(".nextPage, .lastPage").removeClass("pageDisabled").addClass("pageEnabled");var e,f;u.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&(e=i[0]!=r?i[0].Value:i.d!=r?i.d[0].Value:i.EditorTreeInfo,f=n.parseJSON(e),f.splice(-1,1));u.element.find(".memberCurrentPage").val(u._memberPageSettings.currentMemeberPage);u._appendTreeViewData(u.model.operationalMode==t.Pivot.OperationalMode.ClientMode?f:t.DataManager(u._editorTreeData).executeLocal(t.Query().where("pid","equal",null||r).page(u._memberPageSettings.currentMemeberPage,u.model.memberEditorPageSize)),!1);u._unWireEvents();u._wireEvents();u._waitingPopup.hide()},0)},_searchEditorTreeNodes:function(i,u){u._waitingPopup.show();var f=this;setTimeout(function(){var e="",s,o,i;if(e=t.isNullOrUndefined(u._pivotSchemaDesigner)?t.isNullOrUndefined(n.trim(u.element.find(".searchEditorTreeView").val()))?"":n.trim(u.element.find(".searchEditorTreeView").val()).toLowerCase():t.isNullOrUndefined(n.trim(u._pivotSchemaDesigner.element.find(".searchEditorTreeView").val()))?"":n.trim(u._pivotSchemaDesigner.element.find(".searchEditorTreeView").val()).toLowerCase(),e!=""){for(i=jQuery.extend(!0,[],t.DataManager(u._editorTreeData).executeLocal(t.Query().where("name","contains",e,!0))),s=jQuery.extend(!0,[],t.DataManager(i).executeLocal(t.Query().where("pid","notEqual",null||r).where("name","contains",e,!0))),o=0;o<s.length;o++)f._appendParentNodes(i,s[o],u);u._isSearchApplied=!0;t.isNullOrUndefined(u._pivotSchemaDesigner)?u._appendTreeViewData(i,!1):(i.length>0&&i.splice(0,0,{id:"All",name:"All",checkedStatus:u._isAllMemberChecked,tag:""}),f._createSearchTreeview(i,u._pivotSchemaDesigner))}else u._isSearchApplied=!1,t.isNullOrUndefined(u._pivotSchemaDesigner)?u._appendTreeViewData(t.DataManager(u._editorTreeData).executeLocal(t.Query().where("pid","equal",null||r).page(u._memberPageSettings.currentMemeberPage,u.model.memberEditorPageSize)),!1):(i=t.DataManager(u._editorTreeData).executeLocal(t.Query().where("pid","equal",null||r).page(u._memberPageSettings.currentMemeberPage,u.model.memberEditorPageSize)),i.splice(0,0,{id:"All",name:"All",checkedStatus:u._isAllMemberChecked,tag:""}),f._createSearchTreeview(i,u._pivotSchemaDesigner));t.isNullOrUndefined(u._pivotSchemaDesigner)&&(u._unWireEvents(),u._wireEvents());u._waitingPopup.hide()},0)},_createSearchTreeview:function(i,r){var f,u;for(r.element.find(".editorTreeView").ejTreeView({showCheckbox:!0,loadOnDemand:!0,enableRTL:r.model.enableRTL,beforeDelete:function(){return!1},height:r.element.find(".memberEditorDiv").height(),fields:{id:"id",text:"name",isChecked:"checkedStatus",hasChild:"hasChildren",dataSource:i}}),f=r.element.find(".editorTreeView").find("li"),u=0;u<f.length;u++)t.isNullOrUndefined(n(f[u]).attr("id"))||n(f[u]).attr("tag",t.DataManager(i).executeLocal(t.Query().where("id","equal",n(f[u]).attr("id")))[0].tag);r._memberTreeObj=r.element.find(".editorTreeView").data("ejTreeView");r._memberTreeObj.model.nodeCheck=t.proxy(r._nodeCheckChanges,r);r._memberTreeObj.model.nodeUncheck=t.proxy(r._nodeCheckChanges,r);r._memberTreeObj.model.beforeExpand=t.proxy(r._beforeNodeExpand,r);t.isNullOrUndefined(r.element.find(".e-dialog .e-text:visible").first())||(r.element.find(".e-dialog .e-text:visible").length>0?(r.element.find(".e-dialog .e-text:visible").first().attr("tabindex","-1").focus().addClass("hoverCell"),r.element.find(".e-dialog button").removeClass("hoverCell")):r.element.find(".e-dialog button:visible").first().attr("tabindex","-1").focus().addClass("hoverCell"))},_appendParentNodes:function(n,i,r){var u=jQuery.extend(!0,[],t.DataManager(r._editorTreeData).executeLocal(t.Query().where("id","equal",i.pid)));!t.isNullOrUndefined(u)&&u.length>0&&t.DataManager(n).executeLocal(t.Query().where("id","equal",u[0].id)).length==0&&(u[0].expanded=!0,n.push(u[0]),t.isNullOrUndefined(u[0].pid)||this._appendParentNodes(n,u[0],r))},_selectParentTreeNode:function(n,i){var r=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("id","equal",n.pid));!t.isNullOrUndefined(r)&&r.length>0&&(r[0].checkedStatus=!0,this._selectParentTreeNode(r[0],i))},_selectChildTreeNode:function(n,i){var r=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",n.id)),u;if(!t.isNullOrUndefined(r)&&r.length>0)for(u=0;u<r.length;u++)r[u].checkedStatus=!0,this._selectChildTreeNode(r[u],i)},_unSelectChildTreeNode:function(n,i){var r=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",n.id)),u;if(!t.isNullOrUndefined(r)&&r.length>0)for(u=0;u<r.length;u++)r[u].checkedStatus=!1,this._selectChildTreeNode(r[u],i)},_unSelectParentTreeNode:function(n,i){var r=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("id","equal",n.pid));!t.isNullOrUndefined(r)&&r.length>0&&(r[0].checkedStatus=!1,t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",r[0].pid).where("checkedStatus","equal",!0)).length==0&&this._unSelectParentTreeNode(r[0],i))},_getSelectedTreeState:function(n,i){var f,o,h,s,e,u;if(n){for(e=[],f=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",null||r)),u=0;u<f.length;u++){if(o=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",f[u].id)),h={caption:f[u].name,parentId:t.isNullOrUndefined(f[u].pid)?"None":f[u].pid,id:f[u].id,checked:f[u].checkedStatus,expanded:o.length>0?!0:!1,childNodes:[],tag:f[u].tag},o.length>0)for(s=0;s<o.length;s++)h.childNodes.push(this._getEditorSlicerInfo(o[s],i));e.push(h)}return JSON.stringify(e)}for(e="",u=0;u<i._editorTreeData.length;u++)i._editorTreeData[u].checkedStatus==!0&&(e+="::"+i._editorTreeData[u].id+"||"+i._editorTreeData[u].tag);return e},_getUnSelectedTreeState:function(n){for(var i="",t=0;t<n._editorTreeData.length;t++)n._editorTreeData[t].checkedStatus==!1&&(i+="::"+n._editorTreeData[t].id+"||"+n._editorTreeData[t].tag);return i},_getEditorSlicerInfo:function(n,i){var r=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",n.id)),f={caption:n.name,parentId:t.isNullOrUndefined(n.pid)?"None":n.pid,id:n.id,checked:n.checkedStatus,expanded:r.length>0?!0:!1,childNodes:[],tag:n.tag},u;if(r.length>0)for(u=0;u<r.length;u++)f.childNodes.push(this._getEditorSlicerInfo(r[u],i));return f},createErrorDialog:function(i){var r,u;t.Pivot.openPreventPanel(i);i.element.find(".errorDialog").length==0?(u=t.buildTag("div.errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent",i._getLocalizedLabels("AlertMsg"))[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn","OK")[0].outerHTML)[0].outerHTML).attr("title",i._getLocalizedLabels("Warning"))[0].outerHTML,i.element.append(u),i.element.find(".errorDialog").ejDialog({target:"#"+i._id,enableResize:!1,enableRTL:i.model.enableRTL,width:"400px"}),r=i.element.find(".errorDialog").data("ejDialog"),n("#"+r._id+"_wrapper").css({left:"50%",top:"50%"}),i.element.find(".errOKBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(t.Pivot.errOKBtnClick,i)}),i.element.find(".e-dialog .e-close").attr("title",i._getLocalizedLabels("Close"))):(r=i.element.find(".errorDialog").data("ejDialog"),r.open())},errOKBtnClick:function(){this.element.find("#preventDiv").remove();var n=this.element.find(".errorDialog").data("ejDialog");n._ejDialog.find("div.e-dialog-icon").trigger("click")},doAjaxPost:function(i,u,f,e,o,s){var h,c,l,a=!0;f.XMLA==r?(h="application/json; charset=utf-8",c="json",l=n.proxy(e,this)):(h="text/xml",c="xml",f=f.XMLA,l=n.proxy(e,t.olap.base,s),a=t.browserInfo().name=="msie"&&t.browserInfo().version<=9?!1:!t.isNullOrUndefined(s)&&s.action!="loadFieldElements"?!0:!1);n.ajax({type:i,url:u,contentType:h,async:a,dataType:c,data:f,success:l,complete:t.proxy(function(t){n.proxy(t,this);var i={action:this._currentAction,customObject:"",element:this.element}},this),error:t.proxy(function(n){typeof this._ogridWaitingPopup!="undefined"&&this._ogridWaitingPopup!=null&&this._ogridWaitingPopup.hide();typeof oclientWaitingPopup!="undefined"&&oclientWaitingPopup!=null&&oclientWaitingPopup.hide();var t={action:this._drillAction!=""?this._drillAction:"initialize",customObject:"",element:this.element,Message:n};this._trigger("renderFailure",t);this.renderControlFromJSON("");this._dataModel=="XMLA"&&this._createErrorDialog(n.statusText,this._getLocalizedLabels("Error"));n.statusText},this)})},getCubeList:function(t,i){for(var f,u=[],r=0;r<n(i).find("row").length;r++)f=n(n(i).find("row")[r]),u.push({name:n(f).children("CUBE_NAME").text()});t.pvtCtrldObj.setCubeList(u)},generateTreeViewData:function(n){var t={catalog:n.model.pivotControl.model.dataSource.catalog,cube:n.model.pivotControl.model.dataSource.cube,url:n.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"};this._getTreeData(t,this.loadDimensionElements,{schemaData:n,action:"loadFieldElements"})},loadDimensionElements:function(i,u){var h,f=i.schemaData.model.pivotControl,c={},v=t.olap.base._getConnectionInfo(f.model.dataSource.data),o={},a=f.model.dataSource.providerName==t.olap.Providers.Mondrian,s;for(o={catalog:f.model.dataSource.catalog,cube:f.model.dataSource.cube,url:f.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},f.schemaTreeView=[],f.reportItemNames=[],s=0;s<n(u).find("row").length;s++){var l=n(n(u).find("row")[s]),e=l.find("DIMENSION_UNIQUE_NAME").text(),h=l.find("DIMENSION_CAPTION").text();e.toLowerCase().indexOf("[measure")>=0?c={hasChildren:!0,isSelected:!1,id:e,name:h,spriteCssClass:e.toLowerCase()=="[measures]"?"folderCDB e-icon":"dimensionCDB e-icon",tag:e}:!n(n(u).find("row")[0]).find("HIERARCHY_CAPTION").length>0&&f.schemaTreeView.push({hasChildren:!0,isSelected:!1,id:a?e+"~#^Dim":e,name:h,spriteCssClass:"dimensionCDB e-icon",tag:e,defaultHierarchy:n(n(u).find("row")[s]).children("DEFAULT_HIERARCHY").text()})}f.schemaTreeView.splice(0,0,c);!f.model.enableDrillThrough||i.schemaData!=r&&i.schemaData.model.olap.showNamedSets?(o.request="MDSCHEMA_SETS",t.Pivot._getTreeData(o,t.Pivot.loadNamedSetElements,i)):(o.request="MDSCHEMA_HIERARCHIES",(t.isNullOrUndefined(f._fieldData)||!t.isNullOrUndefined(f._fieldData)&&t.isNullOrUndefined(f._fieldData.hierarchy))&&this._getFieldItemsInfo(f),f._fieldData.hierarchySuccess==r?t.Pivot._getTreeData(o,f.loadHierarchyElements,i):t.Pivot.loadHierarchyElements(i,f._fieldData.hierarchySuccess))},loadNamedSetElements:function(i,u){var e=i.schemaData.model.pivotControl,c={catalog:e.model.dataSource.catalog,cube:e.model.dataSource.cube,url:e.model.dataSource.data,request:"MDSCHEMA_HIERARCHIES"},u=e.model.dataSource,h=[],o,s,f;for(o=n.map(u.rows,function(n){if(n.fieldName!=r)return n.fieldName}),n.merge(o,n.map(u.columns,function(n){if(n.fieldName!=r)return n.fieldName})),n.merge(o,n.map(u.filters,function(n){if(n.fieldName!=r)return n.fieldName})),s=0;s<n(u).find("row").length;s++)f=n(n(u).find("row")[s]),n.inArray(f.find("DIMENSIONS").text().split(".")[0],h)>=0||(e.schemaTreeView.push({hasChildren:!0,isSelected:!1,pid:f.find("DIMENSIONS").text().split(".")[0],id:f.find("SET_DISPLAY_FOLDER").text()+"_"+f.find("DIMENSIONS").text().split(".")[0],name:f.find("SET_DISPLAY_FOLDER").text(),spriteCssClass:"folderCDB e-icon namedSets"}),h.push(f.find("DIMENSIONS").text().split(".")[0])),e.schemaTreeView.push({hasChildren:!0,isSelected:n.inArray("["+n.trim(f.children("SET_NAME").text())+"]",o)>=0,pid:f.find("SET_DISPLAY_FOLDER").text()+"_"+f.find("DIMENSIONS").text().split(".")[0],id:"["+n.trim(f.children("SET_NAME").text()).replace(/\&/g,"&amp;")+"]",name:f.children("SET_CAPTION").text(),spriteCssClass:"namedSetCDB e-icon",tag:f.find("EXPRESSION").text()});t.isNullOrUndefined(e._fieldData)||e._fieldData.hierarchySuccess==r?t.Pivot._getTreeData(c,t.Pivot.loadHierarchyElements,i):t.Pivot.loadHierarchyElements(i,e._fieldData.hierarchySuccess)},loadHierarchyElements:function(i,u){var f=i.schemaData.model.pivotControl,v={catalog:f.model.dataSource.catalog,cube:f.model.dataSource.cube,url:f.model.dataSource.data,request:"MDSCHEMA_LEVELS"},c=f.model.dataSource,o,a=f.model.dataSource.providerName==t.olap.Providers.Mondrian,s;for(o=n.map(c.rows,function(n){if(n.fieldName!=r)return n.fieldName}),n.merge(o,n.map(c.columns,function(n){if(n.fieldName!=r)return n.fieldName})),n.merge(o,n.map(c.filters,function(n){if(n.fieldName!=r)return n.fieldName})),s=0;s<n(u).find("row").length;s++){var e=n(n(u).find("row")[s]),l=e.find("DIMENSION_UNIQUE_NAME").text(),h=e.find("HIERARCHY_UNIQUE_NAME").text(),y=n(f.schemaTreeView).filter(function(n,t){return t.tag==l}).map(function(n,t){return t});y.length>0&&(l!=h||a)&&f.schemaTreeView.push({hasChildren:!0,isSelected:n.inArray(h,o)>=0,pid:l+(a?"~#^Dim":""),id:h,name:e.find("HIERARCHY_CAPTION").text(),spriteCssClass:e.find("HIERARCHY_ORIGIN").text()!="2"&&e.find("HIERARCHY_ORIGIN").text()!="6"?"hierarchyCDB e-icon":"attributeCDB e-icon",tag:h})}t.Pivot._getTreeData(v,t.Pivot.loadLevelElements,i)},loadLevelElements:function(i,r){var u=i.schemaData.model.pivotControl,e=n.map(n(r).find("row"),function(t){if(parseInt(n(t).children("LEVEL_TYPE").text())!="1"&&n(t).children("HIERARCHY_UNIQUE_NAME").text().toLowerCase()!="[measures]")return{hasChildren:!1,isChecked:!1,id:n(t).find("LEVEL_UNIQUE_NAME").text(),pid:n(t).find("HIERARCHY_UNIQUE_NAME").text(),name:n(t).find("LEVEL_CAPTION").text(),tag:n(t).find("LEVEL_UNIQUE_NAME").text(),spriteCssClass:"level"+parseInt(n(t).children("LEVEL_NUMBER").text())+" e-icon"}}),f;n.merge(u.schemaTreeView,e);(!u.model.enableDrillThrough||u._fieldData.measureSuccess)&&(t.isNullOrUndefined(u._fieldData)||!u._fieldData.measureSuccess?(f={catalog:u.model.dataSource.catalog,cube:u.model.dataSource.cube,url:u.model.dataSource.data,request:"MDSCHEMA_MEASURES"},t.Pivot._getTreeData(f,t.Pivot.loadMeasureElements,i)):t.Pivot.loadMeasureElements(i,u._fieldData.measureSuccess))},loadMeasureGroups:function(i,r){t.isNullOrUndefined(i.pivotControl._fieldData)&&(i.pivotControl._fieldData={});i.pivotControl._fieldData.measuresGroups=n(r).find("row")},loadMeasureElements:function(i,u){var f=i.schemaData.model.pivotControl,s={catalog:f.model.dataSource.catalog,cube:f.model.dataSource.cube,url:f.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},v=[],y=[],c,h,a;for(v=n.map(f.model.dataSource.values,function(n){if(n.measures!=r)return n.measures}),f.reportItemNames=n.map(v,function(n){if(n.fieldName!=r)return n.fieldName}),f.model.locale!="en-US"&&(s={catalog:f.model.dataSource.catalog,cube:f.model.dataSource.cube,url:f.model.dataSource.data,request:"MDSCHEMA_MEASUREGROUPS"},t.Pivot._getTreeData(s,t.Pivot.loadMeasureGroups,{pivotControl:f,action:"loadFieldElements"})),h=0;h<n(u).find("row").length;h++){var l=n(n(u).find("row")[h]),e=l.children("MEASUREGROUP_NAME").text(),o=l.find("MEASURE_UNIQUE_NAME").text();n.inArray(e,y)>=0||(f.model.locale!="en-US"?(a=n.map(f._fieldData.measuresGroups,function(t){if(n(t).children("MEASUREGROUP_NAME").text()==e)return n(t).children("MEASUREGROUP_CAPTION").text()}),c=a.length>0?a[0]:e):c=e,e!=""&&f.schemaTreeView.push({hasChildren:!0,isChecked:!1,pid:"[Measures]",id:e,name:c,spriteCssClass:"measureGroupCDB e-icon",tag:e}),y.push(e));f.schemaTreeView.push({hasChildren:!0,isSelected:n.inArray(o,f.reportItemNames)>=0,id:o,pid:e==""?"[Measures]":e,name:l.children("MEASURE_CAPTION").text(),spriteCssClass:"measure",tag:o});n.inArray(o,f.reportItemNames)>=0&&f.reportItemNames.splice(f.reportItemNames.indexOf(o),1)}!t.isNullOrUndefined(i.schemaData)&&i.schemaData.model.olap.showKpi?(treeNodeElement={hasChildren:!0,isChecked:!1,id:"folderStruct",name:"KPI",spriteCssClass:"KPICDB folderCDB e-icon",tag:""},f.schemaTreeView.splice(1,0,treeNodeElement),s.request="MDSCHEMA_KPIS",f._getTreeData(s,f.loadKPIElements,i)):t.isNullOrUndefined(i.schemaData)||i.schemaData._createTreeView(this,f.schemaTreeView)},loadKPIElements:function(t,i){for(var r=t.schemaData.model.pivotControl,i=r.model.dataSource,e=this.reportItemNames,a=[],o=0;o<n(i).find("row").length;o++){var f=n(n(i).find("row")[o]),u=f.children("KPI_CAPTION").text(),s=f.children("KPI_goal").text(),h=f.children("KPI_STATUS").text(),c=f.children("KPI_TREND").text(),l=f.find("KPI_VALUE").text();n.inArray(f.children("KPI_NAME").text(),a)>=0||(treeNodeElement={hasChildren:!0,isChecked:!1,pid:"folderStruct",id:u,name:u,spriteCssClass:"measureGroupCDB e-icon",tag:u},r.schemaTreeView.push(treeNodeElement),a.push(u));treeNodeElement={hasChildren:!0,isSelected:n.inArray(s,e)>=0,id:s,pid:u,name:r._getLocalizedLabels("Goal"),spriteCssClass:"kpiGoal e-icon",tag:s};r.schemaTreeView.push(treeNodeElement);treeNodeElement={hasChildren:!0,isSelected:n.inArray(h,e)>=0,id:h,pid:u,name:r._getLocalizedLabels("Status"),spriteCssClass:"kpiStatus e-icon",tag:h};r.schemaTreeView.push(treeNodeElement);treeNodeElement={hasChildren:!0,isSelected:n.inArray(c,e)>=0,id:c,pid:u,name:r._getLocalizedLabels("Trend"),spriteCssClass:"kpiTrend e-icon",tag:c};r.schemaTreeView.push(treeNodeElement);treeNodeElement={hasChildren:!0,isSelected:n.inArray(l,e)>=0,id:l,pid:u,name:r._getLocalizedLabels("Value"),spriteCssClass:"kpiValue e-icon",tag:l};r.schemaTreeView.push(treeNodeElement)}t.schemaData._createTreeView(this,r.schemaTreeView);delete r.reportItemNames;delete r.schemaTreeView},_createCalcMemberDialog:function(i){var o="",s,h,e,c,f,a,l,u;o=i.length>1&&i[0]!=r?JSON.parse(i[0].Value):i.d!=r?JSON.parse(i.d[0].Value):JSON.parse(i.CubeTreeInfo);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"fetchCalcMemberTreeView",element:this.element,customObject:this.model.customObject});t.Pivot.openPreventPanel(this);this.element.find(".calcMemberDialog",".clientDialog",".e-dialog").remove();var v=t.buildTag("div.cubeBrowserCalcMember",t.buildTag("div#"+this._id+"_cubeTreeViewCalcMember.cubeTreeViewCalcMember")[0].outerHTML,{})[0].outerHTML,y=t.buildTag("label.lblCaption",this._getLocalizedLabels("Caption"),{})[0].outerHTML+t.buildTag("input#"+this._id+"_captionFieldCM.captionFieldCM","",{}).attr("aria-label",this._getLocalizedLabels("Caption"))[0].outerHTML,p=t.buildTag("label.lblexpression",this._getLocalizedLabels("Expression"),{})[0].outerHTML+t.buildTag("textarea#"+this._id+"_expressionFieldCM.e-textarea e-droppable expressionFieldCM"+(this.model.enableRTL?" e-rtl":""),"",{}).attr("aria-label",this._getLocalizedLabels("Expression"))[0].outerHTML,w=t.buildTag("label.lblmemberType",this._getLocalizedLabels("MemberType"),{})[0].outerHTML+t.buildTag("input#"+this._id+"_memberTypeFieldCM.memberTypeFieldCM","",{}).attr("aria-label",this._getLocalizedLabels("MemberType"))[0].outerHTML+t.buildTag("input#"+this._id+"_dimensionFieldCM.dimensionFieldCM","",{}).attr("aria-label","dimension")[0].outerHTML,b=t.buildTag("label.lblformat",this._getLocalizedLabels("FormatString"),{})[0].outerHTML+t.buildTag("input#"+this._id+"_formatFieldCM.formatFieldCM","",{}).attr("aria-label",this._getLocalizedLabels("FormatString"))[0].outerHTML+t.buildTag("input#"+this._id+"_customFormatFieldCM.customFormatFieldCM","",{}).attr("aria-label","custom format")[0].outerHTML,k=t.buildTag("div.calcMemberFieldPanel",y+p+w+b,{})[0].outerHTML,d=t.buildTag("button#"+this._id+"_btnOk.btnCalcMemberOk",this._getLocalizedLabels("OK"),{},{name:this._getLocalizedLabels("OK")}).attr("aria-label",this._getLocalizedLabels("OK"))[0].outerHTML,g=t.buildTag("button#"+this._id+"_btnCancel.btnCalcMemberCancel",this._getLocalizedLabels("Cancel"),{},{name:this._getLocalizedLabels("Cancel")}).attr("aria-label",this._getLocalizedLabels("Cancel"))[0].outerHTML,nt=t.buildTag("div.calcMemberFooter",d+g,{})[0].outerHTML;for(this._calcMemberDialog=t.buildTag("div#"+this._id+"_calcMemberDialog",v+k+nt,{})[0].outerHTML,n(this._calcMemberDialog).appendTo("#"+this._id),n("#"+this._id+"_calcMemberDialog").ejDialog({width:"auto",title:this._getLocalizedLabels("CalculatedMember"),cssClass:this.model.cssClass+" calcMemberDialog",enableModal:!1,target:"#"+this._id,enableRTL:this.model.enableRTL,enableResize:!1,close:t.proxy(function(){t.Pivot.closePreventPanel(this)},this),beforeOpen:t.proxy(function(){this.element.find(".calcMemberDialog .e-dialog").css("display","block")},this)}),this._calcMemberDialog=this.element.find("#"+this._id+"_calcMemberDialog").data("ejDialog"),n("#"+this._id+"_btnCancel").ejButton({type:t.ButtonType.Button,width:"80px",enableRTL:this.model.enableRTL,click:t.proxy(function(){this._calcMemberDialog.close();this._selectedCalcMember=null;t.Pivot.closePreventPanel(this)},this)}),n("#"+this._id+"_btnOk").ejButton({type:t.ButtonType.Button,width:"80px",enableRTL:this.model.enableRTL,click:t.proxy(function(){var i,u,r,f;if(n.trim(this.element.find("#"+this._id+"_captionFieldCM").val())==""||n.trim(this.element.find("#"+this._id+"_expressionFieldCM").val())==""){t.Pivot._createErrorDialog(this._getLocalizedLabels("EmptyField"),this._getLocalizedLabels("Warning"),this);return}if(this.element.find("#"+this._id+"_formatFieldCM").val()=="Custom"&&n.trim(this.element.find("#"+this._id+"_customFormatFieldCM").val())==""){t.Pivot._createErrorDialog(this._getLocalizedLabels("EmptyFormat"),this._getLocalizedLabels("Warning"),this);return}if(t.isNullOrUndefined(this._selectedCalcMember))for(i=0;i<this._calcMembers.length;i++)if(n.trim(this.element.find("#"+this._id+"_captionFieldCM").val()).toLowerCase()==this._calcMembers[i].name.toLowerCase())if(confirm(this._getLocalizedLabels("Confirm")))this._selectedCalcMember=n.trim(this.element.find("#"+this._id+"_captionFieldCM").val());else return;this._calcMemberDialog.close();t.Pivot.closePreventPanel(this);u="";t.isNullOrUndefined(this._selectedCalcMember)||(r=t.DataManager(this._calcMembers).executeLocal(t.Query().where("name","equal",this._selectedCalcMember,!0)),!t.isNullOrUndefined(r)&&r.length>0&&(u=r[0].tag));this._selectedCalcMember=null;this._waitingPopup.show();f=JSON.stringify({action:"calculatedMember",olapReport:this.currentReport,clientReports:this.reports,caption:this.currentCubeName+"%"+n.trim(this.element.find("#"+this._id+"_captionFieldCM").val()),expression:n.trim(this.element.find("#"+this._id+"_expressionFieldCM").val()),memberType:this.element.find("#"+this._id+"_memberTypeFieldCM").val(),dimension:this.element.find("#"+this._id+"_dimensionFieldCM").val(),formatString:this.element.find("#"+this._id+"_formatFieldCM").val()=="Custom"?n.trim(this.element.find("#"+this._id+"_customFormatFieldCM").val()):this.element.find("#"+this._id+"_formatFieldCM").val(),uniqueName:u,customObject:this.model.customObject});this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.calculatedMember,f,this._calcMemberDroppedSuccess)},this)}),this.element.find("#"+this._id+"_cubeTreeViewCalcMember").ejTreeView({fields:{id:"id",parentId:"pid",text:"name",spriteCssClass:"spriteCssClass",dataSource:o},allowDragAndDrop:!0,enableRTL:this.model.enableRTL,allowDropChild:!1,allowDropSibling:!1,dragAndDropAcrossControl:!0,cssClass:"calcMemberTreeViewDragedNode",nodeDropped:t.proxy(function(t){t.target!=null&&t.target.attr("id")==""+this._id+"_expressionFieldCM"&&this.element.find("#"+this._id+"_expressionFieldCM").val(this.element.find("#"+this._id+"_expressionFieldCM").val()+n(t.droppedElement).attr("tag"))},this),beforeExpand:t.proxy(t.Pivot._getMemberChildNodes,this)}),this.element.find("#"+this._id+"_captionFieldCM").ejMaskEdit({name:"inputbox",inputMode:t.InputMode.Text,watermarkText:"",maskFormat:"",textAlign:this.model.enableRTL?"right":"left",width:"100%"}),this.element.find("#"+this._id+"_customFormatFieldCM").ejMaskEdit({name:"inputbox",inputMode:t.InputMode.Text,watermarkText:"",maskFormat:"",textAlign:this.model.enableRTL?"right":"left",width:"100%",cssClass:"calcMemberCustomFormat"}),this.element.find(".calcMemberCustomFormat").css("visibility","hidden"),this.element.find("#"+this._id+"_memberTypeFieldCM").ejDropDownList({dataSource:[{text:"Measure",value:"Measure"},{text:"Dimension",value:"Dimension"}],enableRTL:this.model.enableRTL,width:"100%",selectedIndex:0,change:t.proxy(function(n){n.text=="Dimension"?this.element.find(".calcMemberDimensionField").css("visibility","visible"):this.element.find(".calcMemberDimensionField").css("visibility","hidden")},this)}),s=t.DataManager(o).executeLocal(t.Query().where("spriteCssClass","contains","dimensionCDB")),h=[],u=0;u<s.length;u++)h.push({text:s[u].name,value:s[u].name});for(this.element.find("#"+this._id+"_dimensionFieldCM").ejDropDownList({dataSource:h,selectedIndex:0,width:"100%",enableRTL:this.model.enableRTL,cssClass:"calcMemberDimensionField"}),this.element.find(".calcMemberDimensionField").css("visibility","hidden"),this.element.find("#"+this._id+"_formatFieldCM").ejDropDownList({dataSource:[{text:"Standard",value:"Standard"},{text:"Currency",value:"Currency"},{text:"Percent",value:"Percent"},{text:"Custom",value:"Custom"}],enableRTL:this.model.enableRTL,selectedIndex:0,width:"100%",enableRTL:this.model.enableRTL,change:t.proxy(function(n){n.text=="Custom"?this.element.find(".calcMemberCustomFormat").css("visibility","visible"):this.element.find(".calcMemberCustomFormat").css("visibility","hidden")},this)}),e=this.element.find(".cubeTreeViewCalcMember").find("li"),u=0;u<e.length;u++)t.isNullOrUndefined(n(e[u]).attr("id"))||n(e[u]).attr("tag",t.DataManager(o).executeLocal(t.Query().where("id","equal",n(e[u]).attr("id")))[0].tag);for(c=this.element.find(".cubeTreeViewCalcMember .folderCDB"),u=0;u<c.length;u++)n(c[u].parentElement).removeClass("e-draggable");if(this.element.find(".cubeTreeViewCalcMember .calcMemberGroupCDB").length>0&&this.element.find(".cubeTreeViewCalcMember .calcMemberGroupCDB").parent().removeClass("e-draggable"),this._calcMemberTreeObj=this.element.find(".cubeTreeViewCalcMember").data("ejTreeView"),!t.isNullOrUndefined(this._selectedCalcMember)&&(f=t.DataManager(this._calcMembers).executeLocal(t.Query().where("name","equal",this._selectedCalcMember)),f.length>0)){if(this.element.find("#"+this._id+"_captionFieldCM").val(f[0].name),this.element.find("#"+this._id+"_expressionFieldCM").val(f[0].expression),this.element.find("#"+this._id+"_memberTypeFieldCM").data("ejDropDownList").selectItemsByIndices(f[0].nodeType),f[0].nodeType==1)for(a=f[0].tag.split(".")[0].replace(/\[/g,"").replace(/\]/g,""),l=this.element.find("#"+this._id+"_dimensionFieldCM").data("ejDropDownList").model.dataSource,u=0;u<l.length;u++)l[u].value==a&&this.element.find("#"+this._id+"_dimensionFieldCM").data("ejDropDownList").selectItemsByIndices(u);t.isNullOrUndefined(f[0].formatString)||(f[0].formatString=="Currency"?this.element.find("#"+this._id+"_formatFieldCM").data("ejDropDownList").selectItemsByIndices(1):f[0].formatString=="Percent"?this.element.find("#"+this._id+"_formatFieldCM").data("ejDropDownList").selectItemsByIndices(2):(this.element.find("#"+this._id+"_formatFieldCM").data("ejDropDownList").selectItemsByIndices(2),this.element.find("#"+this._id+"_customFormatFieldCM").val(f[0].formatString)))}this._waitingPopup.hide()},_getMemberChildNodes:function(i){var r,u,f;(n(i.currentElement).find("a > span")[0].className.indexOf("level")>-1||n(i.currentElement).find("a > span")[0].className.indexOf("member")>-1)&&(r=t.DataManager(this._calcMemberTreeObj.dataSource()).executeLocal(t.Query().where("pid","equal",n(i.currentElement).attr("id")).where("name","equal","(Blank)")),!t.isNullOrUndefined(r)&&r.length>0&&(this._calcMemberTreeObj.hideNode(r[0].id),this.pNode=i.currentElement,this._waitingPopup.show(),u=n(i.currentElement).find("a > span")[0].className.indexOf("level")>-1?"level":"member",this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"fetchMemberChildNodes",element:this.element,customObject:this.model.customObject}),f=JSON.stringify(this.model.customObject),this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.fetchMemberTreeNodes,JSON.stringify({action:"fetchMemberChildNodes",dimensionName:n(i.currentElement).attr("tag")+":"+u+":"+n(i.currentElement).attr("id"),olapReport:this.currentReport,customObject:f}),t.proxy(t.Pivot._fetchMemberSuccess,this))))},_fetchMemberSuccess:function(u){var f=[],e,o;for(f=u.length>1&&u[0]!=r?JSON.parse(u[0].Value):u.d!=r?JSON.parse(u.d[0].Value):JSON.parse(u.MemberChildNodes),this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"fetchMemberChildNodes",element:this.element,customObject:this.model.customObject}),this._calcMemberTreeObj.model.beforeExpand=null,this._calcMemberTreeObj.addNode(f,n(this.pNode)),e=t.DataManager(this._calcMemberTreeObj.dataSource()).executeLocal(t.Query().where("pid","equal",n(this.pNode).attr("id")).where("name","equal","(Blank)")),!t.isNullOrUndefined(e)&&e.length>0&&this._calcMemberTreeObj.removeNode(e[0].id),n.each(n(this.pNode).children().find("li"),function(n,t){t.setAttribute("tag",f[n].tag)}),o=n(this.pNode).children().find("li"),i=0;i<o.length;i++)f[i].hasChildren==!0&&(this._calcMemberTreeObj.addNode({id:f[i].id+"_Blank_"+i,name:"(Blank)",parentId:f[i].id},o[i]),this.element.find("#"+f[i].id).find("> div > div:first").removeClass("e-process"),this._calcMemberTreeObj.collapseNode(this.element.find("#"+f[i].id)));this._calcMemberTreeObj.model.beforeExpand=t.proxy(t.Pivot._getMemberChildNodes,this);this._waitingPopup.hide()},_drillThroughCellClick:function(r,u){var s,f,h,e,c,o;if(u._waitingPopup.show(),f=n(r.currentTarget.parentElement).attr("p"),u.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)u.doAjaxPost("POST",u.model.url+"/"+u.model.serviceMethodSettings.drillThroughDataTable,JSON.stringify({currentReport:JSON.parse(u.getOlapReport()).Report,layout:u.model.layout,cellPos:f,customObject:JSON.stringify(u.model.customObject)}),function(t){n(u.element).parents(".e-pivotclient").length>0?n(u.element).parents(".e-pivotclient").data("ejPivotClient")._trigger("drillThrough",{element:u.element,data:t}):u._trigger("drillThrough",{element:u.element,data:t})});else{for(h=n("#"+u._id).find("tbody").find("tr:first").find("th").length,i=0;i<h;i++)e=u.getJSONRecords()[parseInt(i*u._rowCount+parseInt(f.split(",")[1]))].Info.indexOf("Measures")!=-1||u.getJSONRecords()[parseInt(i*u._rowCount+parseInt(f.split(",")[1]))].RowSpan<=1?u.getJSONRecords()[parseInt(i*u._rowCount+parseInt(f.split(",")[1]))].Info.split("::")[0]:"",e.indexOf("Measures")!=-1&&(s=e),e!=""&&(u._rowHeader[i]=e);for(c=n("#"+u._id).find("tbody").find('[p="'+parseInt(f.split(",")[0])+","+parseInt(f.split(",")[1])+'"]').closest("tbody").prev().children("tr").length,i=0;i<c;i++)o=u.getJSONRecords()[parseInt(parseInt(f.split(",")[0])*u._rowCount+i)].Info.indexOf("Measures")!=-1||u.getJSONRecords()[parseInt(parseInt(f.split(",")[0])*u._rowCount+i)].ColSpan<=1?u.getJSONRecords()[parseInt(parseInt(f.split(",")[0])*u._rowCount+i)].Info.split("::")[0]:"",o.indexOf("Measures")!=-1&&(s=o),o!=""&&(u._colHeader[i]=o);for((t.isNullOrUndefined(u._fieldData)||!t.isNullOrUndefined(u._fieldData)&&t.isNullOrUndefined(u._fieldData.hierarchy))&&u._getFieldItemsInfo(u),j=0;j<u._fieldData.measures.length;j++)s==u._fieldData.measures[j].id&&(u.measureGrp=u._fieldData.measures[j].pid);u._rowHeader=n.grep(u._rowHeader,function(n){return n==0||n});u._colHeader=n.grep(u._colHeader,function(n){return n==0||n});u._createDrillThroughQuery("",u)}},openHierarchySelector:function(n,i){var r,u,f;n.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._createDrillThroughDialog(n,i):(n._waitingPopup.show(),r=n.target.className.indexOf("e-pivotclient")>=0?n._pivotGrid:n,u=r._getConnectionInfo(n.model.dataSource.data),f='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_MEASUREGROUP_DIMENSIONS<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+n.model.dataSource.catalog+"<\/CATALOG_NAME><CUBE_NAME>"+n.model.dataSource.cube+"<\/CUBE_NAME><MEASUREGROUP_NAME>"+r.measureGrp+"<\/MEASUREGROUP_NAME><\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+n.model.dataSource.catalog+"<\/Catalog> <LocaleIdentifier>"+u.LCID+"<\/LocaleIdentifier><\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>",this.doAjaxPost("POST",u.url,{XMLA:f},r._loadDimensionElements,null,{pvtGridObj:r,action:"loadMeasureElements"}))},_createDrillThroughDialog:function(i,r){var e,u,o,f;i.model.operationalMode!=t.PivotGrid.OperationalMode.ServerMode&&r.shift();i.element.find(".e-dialog:not(.calcMemberDialog, .calcMemberDialog .e-dialog), .clientDialog").remove();var s=t.buildTag("label#",i._getLocalizedLabels("SelectHierarchy"))[0].outerHTML,h="<div class=cubeTable style='width:200px; overflow:auto'><div valign=\"bottom\">"+this._createHierarchyBrowser()+"<\/div><\/div>",c=t.buildTag("div#dropDlg.dropDlg",'<table class="outerTable"><tr><td>'+h+"<\/td><td>"+s+"<br><textarea id='hrSel' style='width:270px; height:300px; resize:none; margin:0px 5px 0 5px'><\/textarea><\/br><br><\/td><\/tr><\/table>")[0].outerHTML+"<\/br>",l=t.buildTag("div",t.buildTag("button#btnOK.dialogBtnOK",i._getLocalizedLabels("OK"))[0].outerHTML+t.buildTag("button#btnCancel.dialogBtnCancel",i._getLocalizedLabels("Cancel"))[0].outerHTML,{float:"right",margin:"-5px 0 6px"})[0].outerHTML,a=t.buildTag("div#clientDialog.clientDialog",c+l,{opacity:"1"}).attr("title","Hierarchy Selector")[0].outerHTML;for(n(a).appendTo("#"+i._id),n("#btnOK, #btnCancel").ejButton(),n("#btnOK, #btnCancel").css({margin:"0 20px 20px 0",width:"50px"}),i.element.find(".clientDialog").ejDialog({width:550,target:"#"+i._id,enableResize:!1,enableRTL:i.model.enableRTL,close:t.proxy(t.Pivot.closePreventPanel,i)}),i.element.find(".cubeTreeViewHierarchy").ejTreeView({showCheckbox:!0,fields:{id:"id",parentId:"pid",text:"name",isChecked:"isSelected",spriteCssClass:"spriteCssClass",dataSource:i.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?n.parseJSON(r.d):r},allowDragAndDrop:!0,allowDropChild:!1,allowDropSibling:!1,enableRTL:i.model.enableRTL?!0:!1,beforeDelete:function(){return!1},dragAndDropAcrossControl:!0,nodeDropped:t.proxy(this._hierarchyNodeDropped,i)}),i._tableTreeObj=i.element.find(".cubeTreeViewHierarchy").data("ejTreeView"),i._tableTreeObj.element.find(".e-ul").css({width:"100%",height:"100%"}),i._tableTreeObj.element.find(".e-chkbox-wrap").remove(),e=i._tableTreeObj.element.find("li"),u=0;u<e.length;u++)o=i.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?n.parseJSON(r.d)[u].tag:r[u].tag,e[u].setAttribute("tag",o);i._tableTreeObj&&i._tableTreeObj.element.find("li").mouseover(t.proxy(function(t){n(t.target).parent().find(".measureGroupCDB, .dimensionCDB, .folderCDB").length>0&&n(t.target).css("cursor","default")},i));f=i;n("#btnOK").click(function(){var i=n("#hrSel").val();n(".e-dialog:not(.calcMemberDialog, .calcMemberDialog .e-dialog), .clientDialog, .drilltableDialog").remove();f._waitingPopup.show();t.olap._mdxParser._createDrillThroughQuery(i,f);f._waitingPopup.hide()});n("#btnCancel").click(function(){n(".e-dialog:not(.calcMemberDialog, .calcMemberDialog .e-dialog), .clientDialog").remove();f._waitingPopup.hide()});i.model.enableRTL&&(n(".e-dialog").addClass("e-rtl"),n(".dialogBtnCancel").css("margin","0 -70px 0 0"))},_createHierarchyBrowser:function(){return t.buildTag("div.cubeBrowserHierarchy",t.buildTag("div.cubeTreeViewHierarchy")[0].outerHTML,{width:"200px",height:"300px",overflow:"auto"})[0].outerHTML},_hierarchyNodeDropped:function(i){var r,f,u;if(i.dropTarget[0].id=="hrSel"){for(r=n(n(i.droppedElement).children()[0]).find(".dimensionCDB").length>0?this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?n(i.droppedElement).find("li:first").attr("tag"):n(i.droppedElement).find("li:first")[0].id:n(i.droppedElement).find("li:first").length==0?this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?n(i.droppedElement.parent().parent()).attr("tag"):n(i.droppedElement.parent().parent())[0].id:this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?n(i.droppedElement).attr("tag"):i.droppedElementData.id,r=r.replace("[","[$"),f=0;f<n("#hrSel").val().split(",").length;f++)if(r==n("#hrSel").val().split(",")[f])return!1;u=this.element.find("#hrSel").val();u.length!=0?(u=u+","+r,this.element.find("#hrSel").val(u)):this.element.find("#hrSel").val(r)}},_generateDrillData:function(t,i){for(var e=n(i).find("row").children(),r=n.map(e,function(n){var t=parseFloat(n.textContent),i=n.tagName.replace(/_x005B_/g,"[").replace(/_x0020_/g," ").replace(/_x005D_/g,"]").replace(/_x0024_/g,"$").replace("].[","]-[");return'"'+i+'":'+t}),o=r[0],u="",f=0;f<r.length;f++){if(r[f]==o){u+=u==""?"[{"+r[f]:"}, {"+r[f];continue}u+=","+r[f]}u+="}]";n(t.pvtGridObj.element).parents(".e-pivotclient").length>0?n(t.pvtGridObj.element).parents(".e-pivotclient").data("ejPivotClient")._trigger("drillThrough",{element:t.pvtGridObj.element,data:u}):t.pvtGridObj._trigger("drillThrough",{element:t.pvtGridObj.element,data:u})},_getFilterState:function(i,r,u,f){var e="",o;return f.model.operationalMode==t.Pivot.OperationalMode.ClientMode?i?((f._fieldSelectedMembers[u.fieldName.toLowerCase()]=="All"||t.isNullOrUndefined(f._fieldSelectedMembers[u.fieldName.toLowerCase()]))&&t.olap._mdxParser.getAllMember(f.model.dataSource,u.fieldName,f),e=f._fieldSelectedMembers[u.fieldName.toLowerCase()]=="All"||t.isNullOrUndefined(f._fieldSelectedMembers[u.fieldName.toLowerCase()])?f._allMember:f._fieldSelectedMembers[u.fieldName.toLowerCase()]):e=u.filterItems.filterType=="include"?u.filterItems.values.length==1?u.filterItems.values[0]:f._getLocalizedLabels("MultipleItems"):r.length-(u.filterItems.values.indexOf("All")==-1?u.filterItems.values.length:u.filterItems.values.length-1)==1?r.filter(function(n){if(u.filterItems.values.indexOf(n.toString())==-1)return n}):f._getLocalizedLabels("MultipleItems"):f.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(o=t.isNullOrUndefined(f._tempFilterData)?[]:n.map(f._tempFilterData,function(n){return n[u.DimensionHeader]}),e=o.length>0&&f._fieldMembers[u.DimensionHeader]?f._fieldMembers[u.DimensionHeader].length-o.length==1?f._fieldMembers[u.DimensionHeader].filter(function(n){if(o.indexOf(n)==-1)return n}):f._getLocalizedLabels("MultipleItems"):f._getLocalizedLabels("All")):e=(f._fieldSelectedMembers[u.Tag]=="All"?u.AllMember:f._fieldSelectedMembers[u.Tag])||u.AllMember,e},_getTreeViewItems:function(t){for(var r,e=t.element.find(".editorTreeView"),u=[],f=n(e).find(":input.nodecheckbox"),i=0;i<f.length;i++)r=n(f[i]).parents("li:eq(0)"),u.push({Id:r[0].id,name:n(r[0]).find("a:eq(0)").text()});return u},_getEditorMember:function(i,r,u){var f,h,e,o;if(r.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){var c=this._getTreeViewItems(u?r._schemaData:r),l=n.extend(!0,[],u?r._schemaData._memberTreeObj.dataSource():r._memberTreeObj.dataSource()),s=n.map(c,function(i){if(i.Id!="All")return n.map(l,function(n){i.Id==n.id&&(i=n,i.name=t.isNullOrUndefined(i.parentId)?i.name+"_1":i.name)}),i}),f=[],e=n.map(s,function(t){return n.map(s,function(n){t.parentId==n.id&&(t.name=t.name+"_"+(Number(n.name.split("_")[n.name.split("_").length-1])+1))}),t});return n.map(e,function(n){var t=n.name.split("_")[n.name.split("_").length-2],i=Number(n.name.split("_")[n.name.split("_").length-1]),r=n.checkedStatus;f.push({name:t,checked:r,level:Number(i)})}),this._updateEditorMembers(i,f,r)}if(r.model.analysisMode==t.Pivot.AnalysisMode.Olap)return f=[],r.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&r.model.enableMemberEditorPaging?(e=r._editorTreeData,n.map(e,function(n){var t=n.name,i=n.id.split("_")[n.id.split("_").length-1],r=n.checkedStatus;f.push({name:t,checked:r,level:Number(i)})})):(h=u?r._schemaData.element.find(".editorTreeView"):r.element.find(".editorTreeView"),e=n(h).find(":input.nodecheckbox"),n.map(e,function(t){if(n(t).parents("li:eq(0)").attr("id")!="All"){var i=n(t).parent().siblings("a").text(),r=t.value.split("_")[t.value.split("_").length-1],u=t.checked||n(t.parentElement).attr("aria-checked")=="mixed"?!0:!1;f.push({name:i,checked:u,level:Number(r)})}})),this._updateEditorMembers(i,f,r);for(textArr=[],o=1;o<i.length;o++)textArr.push(n(i[o].parentElement).siblings("a").text());return textArr},_updateEditorMembers:function(i,r,u){var f,y,s,a;if(!t.isNullOrUndefined(u._fieldMembers[i])){var v=[],e=0,c="",o=u._fieldMembers[i];for(f=0;f<r.length;f++)if(t.isNullOrUndefined(o[f+e])||r[f].level==o[f+e].level)v.push(r[f]);else if(t.isNullOrUndefined(o[f+e])||r[f].level<o[f+e].level){s=f;do r[f-1].checked&&v.push(o[s]),e++,s++;while(r[f].level<o[s].level);f--}else if(t.isNullOrUndefined(o[f+e])||r[f].level>o[f+e].level){y=o[f+e].level;s=f;do v.push(r[s]),e--,s++,f=s-1;while(r[s].level>y)}}u._fieldMembers[i]=t.isNullOrUndefined(u._fieldMembers[i])?r:v;var l=1,p="",w="",h=[];do if(a=n.map(u._fieldMembers[i],function(n){if(n.level==l)return n}),h=n.map(a,function(n){if(n.checked)return n}),a.length==h.length)c=l==1?"All":p,a.length>1&&(w="All"),l++;else if(h.length==1)p=c=w=="All"?"multiple":h[0].name,l++;else if(h.length>1&&a.length>h.length){c="multiple";break}while(h.length>0&&c!="All"&&c!="multiple"&&n.map(u._fieldMembers[i],function(n){if(n.level==l)return n}).length>0);return c},_getTreeData:function(n,i,r){var u=t.olap.base._getConnectionInfo(n.url),f='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>'+n.request+"<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>"+n.catalog+"<\/CATALOG_NAME>"+(r.action=="loadcubelist"?"":"<CUBE_NAME>"+n.cube+"<\/CUBE_NAME>")+"<\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+n.catalog+"<\/Catalog><LocaleIdentifier>"+u.LCID+"<\/LocaleIdentifier> <\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>";r.action="loadFieldElements";this.doAjaxPost("POST",u.url,{XMLA:f},i,null,r)},updateTreeView:function(t){for(var h,c,o,s,f,e=t.element.find(".editorTreeView").find("li"),l=e.length,i=t._memberTreeObj.dataSource(),a=i.length,u=0;u<l;u++)for(h=n(e[u]).find("span:first").attr("aria-checked"),f=0;f<a;f++)if(e[u].id==i[f].id&&(h=="mixed"||h=="true")){i[f].checkedStatus=!0;break}else if(e[u].id==i[f].id&&h=="false"){i[f].checkedStatus=!1;break}for(u=0;u<i.length;u++)if(c=!1,i[u].checkedStatus==!0){for(f=0;f<i.length;f++)if(i[f].hasOwnProperty("parentId")&&i[f].parentId==i[u].id&&i[f].checkedStatus==!0){c=!0;break}if(!c)for(o=0;o<i.length;o++)i[o].hasOwnProperty("parentId")&&i[o].parentId==i[u].id&&(i[o].checkedStatus=!0)}else if(i[u].checkedStatus==!1)for(s=0;s<i.length;s++)i[s].hasOwnProperty("parentId")&&i[s].parentId==i[u].id&&(i[s].checkedStatus=!1);for(u=0;u<l;u++)if(n(e[u]).attr("tag")==null||r)for(f=0;f<a;f++)if(n(e[u]).attr("id")==i[f].id){n(e[u]).attr("tag",i[f].tag);break}return t._memberTreeObj},getNodesState:function(n){for(var r="",u="",i=[],i=n.pluginName=="ejTreeView"?n.dataSource():n,t=0;t<i.length;t++)i[t].checkedStatus==!0?r+="::"+i[t].id+"||"+i[t].tag+"||"+i[t].parentId+"||"+i[t].name:u+="::"+i[t].parentId+"||"+i[t].tag+"||"+i[t].name;return{selectedNodes:r,unSelectedNodes:u}},removeParentSelectedNodes:function(t){for(var i,u=n.extend([],t),f=0;f<t.length;f++)for(i=0;i<u.length;i++)u[i].Id==t[f].parentId&&u.splice(i,1);return n.map(u,function(n){if(n.tag!=""&&n.tag!=r)return n.tag.replace(/\&/g,"&amp;")})},getChildNodes:function(i,u,f,e,o){var s=i.targetElement,p=e.cube,w=e.catalog,b=e.data,k=o._generateChildMembers,v=n(i.currentElement).find("li").length,h=!1,c,a;if(v==0){var y=t.buildTag("span.nodeExpand e-load e-icon")[0].outerHTML,l=n(s).parents("li:eq(0)").attr("id"),d=n.map(f,function(i){if(i.fieldName==u&&!t.isNullOrUndefined(i.filterItems)){var f=i.filterItems;(t.isNullOrUndefined(o.model.pivotControl)?o.model.enableMemberEditorPaging:o.model.pivotControl.model.enableMemberEditorPaging)?(f=n.map(f,function(n){if(n.pid!=r&&n.pid==l.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-"))return h=!0,n}),f.length>0&&h==!0&&(n(s).parents("li:eq(0)").find(".nodeExpand").remove(),n(s).parents("li:eq(0)").find(".e-load").removeClass("e-load"),n.each(f,function(n,t){delete t.parentId}),o._memberTreeObj.addNode(f,n(s).parents("li:eq(0)")),n.each(n(s).parents("li:eq(0)").find("li"),function(n,t){t.setAttribute("tag",f[n].tag)}))):n.map(f,function(n){n.parentId!=r&&n.parentId==l.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-")&&(h=!0)})}});i.isChildLoaded=h?!0:!1;h||(n(s).parents("li:eq(0)").prepend(y),n(s).parents("li:eq(0)").attr("tag")==r&&(c=n.map(f,function(n){if(n.fieldName==u)return n})[0],c&&n.map(c.filterItems,function(t){t.id==n(s).parents("li:eq(0)").attr("id")&&n(s).parents("li:eq(0)").attr("tag",t.tag)})),a=n(s).parents("li:eq(0)").attr("tag").replace(/\&/g,"&amp;"),t.olap._mdxParser.getChildren(e,a,o))}},_getFilterParams:function(n,i,r){var o="",f,u,e;if(n!="schemaValue"){if(f="",!t.isNullOrUndefined(i))for(u=0;u<i.length;u++)if(!t.isNullOrUndefined(i[u][r]))for(e=0;e<i[u][r].length;e++)f+="##"+i[u][r][e];f!=""&&(o=n+"::"+r+"::FILTERED"+f)}return o},generateChildMembers:function(i,r){for(var h,c,o=n(r).find("Axis:eq(0) Tuple"),f=[],u=n("[tag='"+i.currentNode.replace(/&amp;/g,"&")+"']"),e=0;e<o.length;e++){var s=n(n(r).find("Axis:eq(0) Tuple:eq("+e+")").children().children()[0]).text(),l=n(n(r).find("Axis:eq(0) Tuple:eq("+e+")").children()).find("Caption").text()==""?"(Blank)":n(n(r).find("Axis:eq(0) Tuple:eq("+e+")").children()).find("Caption").text(),a={hasChildren:n(o[e]).find("CHILDREN_CARDINALITY").text()!="0",checkedStatus:!1,id:s.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-"),name:l,tag:s};f.push(a)}parentNode=n(u).parents("li").length>1?n(u).parents("li").first():n(u).parents("li");n(n(parentNode).find("input.nodecheckbox")[0]).ejCheckBox({checked:!1});this._memberTreeObj=n(".editorTreeView").data("ejTreeView");f.length>0&&!t.isNullOrUndefined(this.model)&&this.model.pivotControl.element.hasClass("e-pivotclient")&&this.model.pivotControl.model.enableMemberEditorPaging&&(h=this._selectedFieldName,c=this.model.pivotControl,n.map(this.model.pivotControl._currentReportItems,function(i){i.fieldName!=h||t.isNullOrUndefined(i.filterItems)||(n.each(f,function(t,i){i.pid=n(u).attr("id")}),n.merge(i.filterItems,f),c._editorTreeData=i.filterItems)}));u.find(".nodeExpand").remove();u.find(".e-load").removeClass("e-load");this._memberTreeObj.addNode(f,n(u));n.each(u.find("li"),function(n,t){t.setAttribute("tag",f[n].tag)})},createAdvanceFilterTag:function(r,u){var f="",k=t.buildTag("li.e-separator").css("margin-left","29px")[0].outerHTML,o=u.element.hasClass("e-pivotschemadesigner")?u.model.pivotControl.model.operationalMode:u.model.operationalMode,b=u.element.hasClass("e-pivotschemadesigner")?u.model.pivotControl.model.analysisMode:u.model.analysisMode,h,c,s,a,v,e,y,l,p,w;if(r.action=="filterTag")f=[{id:"ascOrder",text:u._getLocalizedLabels("SortAtoZ"),parentId:null,spriteCssClass:"ascImage e-icon"},{id:"descOrder",text:u._getLocalizedLabels("SortZtoA"),parentId:null,spriteCssClass:"descImage e-icon"},{id:"clearSorting",text:u._getLocalizedLabels("ClearSorting"),parentId:null,spriteCssClass:"e-clrSort e-icon"},{id:"sep",parentId:null,text:"",spriteCssClass:"e-seperator"},{id:"clearAllFilters",text:u._getLocalizedLabels("ClearFilterFrom"),parentId:null,spriteCssClass:"e-clrFilter e-icon"},{id:"labelFilterBtn",text:u._getLocalizedLabels("LabelFilters"),parentId:null},{id:"valueFilterBtn",text:u._getLocalizedLabels("ValueFilters"),parentId:null},{id:"labelClearFilter",parentId:"labelFilterBtn",text:u._getLocalizedLabels("ClearFilter"),spriteCssClass:"e-clrFilter e-icon"},{id:"sep",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"equals",parentId:"labelFilterBtn",text:u._getLocalizedLabels("Equals"),spriteCssClass:"sprite"},{id:"notequals",parentId:"labelFilterBtn",text:u._getLocalizedLabels("DoesNotEquals")+"...",spriteCssClass:"sprite"},{id:"sep",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"beginswith",parentId:"labelFilterBtn",text:u._getLocalizedLabels("BeginsWith")+"...",spriteCssClass:"sprite"},{id:"notbeginswith",parentId:"labelFilterBtn",text:u._getLocalizedLabels("DoesNotBeginsWith")+"...",spriteCssClass:"sprite"},{id:"endswith",parentId:"labelFilterBtn",text:u._getLocalizedLabels("EndsWith")+"...",spriteCssClass:"sprite"},{id:"notendswith",parentId:"labelFilterBtn",text:u._getLocalizedLabels("DoesNotEndsWith")+"...",spriteCssClass:"sprite"},{id:"sep",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"contains",parentId:"labelFilterBtn",text:u._getLocalizedLabels("Contains")+"...",spriteCssClass:"sprite"},{id:"notcontains",parentId:"labelFilterBtn",text:u._getLocalizedLabels("DoesNotContains")+"...",spriteCssClass:"sprite"},{id:"sep",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"greaterthan",parentId:"labelFilterBtn",text:u._getLocalizedLabels("GreaterThan")+"...",spriteCssClass:"sprite"},{id:"greaterthanorequalto",parentId:"labelFilterBtn",text:u._getLocalizedLabels("GreaterThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"lessthan",parentId:"labelFilterBtn",text:u._getLocalizedLabels("LessThan")+"...",spriteCssClass:"sprite"},{id:"lessthanorequalto",parentId:"labelFilterBtn",text:u._getLocalizedLabels("LessThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"valueClearFilter",parentId:"valueFilterBtn",text:u._getLocalizedLabels("ClearFilter"),spriteCssClass:"e-clrFilter e-icon"},{id:"sep",parentId:"valueFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"equals",parentId:"valueFilterBtn",text:u._getLocalizedLabels("Equals"),spriteCssClass:"equals"},{id:"notequals",parentId:"valueFilterBtn",text:u._getLocalizedLabels("DoesNotEquals")+"...",spriteCssClass:"sprite"},{id:"sep",parentId:"valueFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"greaterthan",parentId:"valueFilterBtn",text:u._getLocalizedLabels("GreaterThan")+"...",spriteCssClass:"sprite"},{id:"greaterthanorequalto",parentId:"valueFilterBtn",text:u._getLocalizedLabels("GreaterThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"lessthan",parentId:"valueFilterBtn",text:u._getLocalizedLabels("LessThan")+"...",spriteCssClass:"sprite"},{id:"lessthanorequalto",parentId:"valueFilterBtn",text:u._getLocalizedLabels("LessThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"sep",parentId:"valueFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"between",parentId:"valueFilterBtn",text:u._getLocalizedLabels("Between")+"...",spriteCssClass:"sprite"},{id:"notbetween",parentId:"valueFilterBtn",text:u._getLocalizedLabels("NotBetween")+"...",spriteCssClass:"sprite"},{id:"sep",parentId:"valueFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"topCount",parentId:"valueFilterBtn",text:u._getLocalizedLabels("Top10")+"...",spriteCssClass:"sprite"}],o==t.Pivot.OperationalMode.ClientMode||o==t.Pivot.OperationalMode.ServerMode&&b==t.Pivot.AnalysisMode.Pivot?f.splice(f.length-1,2):f.splice(0,5);else if(r.action=="clearFilter")f=t.buildTag("div.clearSorting",t.buildTag("span.e-clrSort","",{padding:"0px 10px 0px 4px"}).addClass("e-icon").attr("aria-label","clear sort")[0].outerHTML+t.buildTag("span.clearSortText","Clear Sorting",{padding:"5px 0px"})[0].outerHTML)[0].outerHTML+t.buildTag("div.separator",{padding:"5px 0px"})[0].outerHTML+t.buildTag("div.clearAllFilters",t.buildTag("span.e-clrFilter","",{padding:"0px 10px 0px 4px"}).addClass("e-icon").attr("aria-label"," clear filter")[0].outerHTML+t.buildTag("span.clearFltrText",'Clear Filter From"'+r.selectedLevel.text+'"',{padding:"5px 0px"})[0].outerHTML)[0].outerHTML;else if(r.action=="sort")f=t.buildTag("div#sortDiv.sortDiv",t.buildTag("li#ascOrder.ascOrder",t.buildTag("span.ascImage").addClass("e-icon").attr("aria-label","ascending")[0].outerHTML+u._getLocalizedLabels("Sort")+" A to Z")[0].outerHTML+t.buildTag("li#descOrder.descOrder",t.buildTag("span.descImage").addClass("e-icon").attr("aria-label","descending")[0].outerHTML+u._getLocalizedLabels("Sort")+" Z to A")[0].outerHTML)[0].outerHTML;else if(r.action=="labelFilterDlg"||r.action=="valueFilterDlg"){if(h="",c=[],r.action=="labelFilterDlg")h=t.buildTag("table.labelfilter",t.buildTag("tr",t.buildTag("td",u._getLocalizedLabels("LabelFilterLabel")).attr("colspan","2")[0].outerHTML)[0].outerHTML+t.buildTag("tr",t.buildTag("td","<input type='text' id='filterOptions' class='filterOptions'  style='width:220px'/>")[0].outerHTML+t.buildTag("td.filterValuesTd","<input type='text' id='filterValue1'  value='"+(r.filterInfo.length>0?o==t.Pivot.OperationalMode.ClientMode?r.filterInfo[0].values[0]:r.filterInfo[0].value1:"")+"' style='display:inline; width:160px; height:19px; margin-left:7px;' class='filterValues'/><\/br>")[0].outerHTML)[0].outerHTML)[0].outerHTML,c=[{value:"equals",option:u._getLocalizedLabels("Equals").toLowerCase()},{value:"not equals",option:u._getLocalizedLabels("DoesNotEquals").toLowerCase()},{value:"begins with",option:u._getLocalizedLabels("BeginsWith").toLowerCase()},{value:"not begins with",option:u._getLocalizedLabels("DoesNotBeginsWith").toLowerCase()},{value:"ends with",option:u._getLocalizedLabels("EndsWith").toLowerCase()},{value:"not ends with",option:u._getLocalizedLabels("DoesNotEndsWith").toLowerCase()},{value:"contains",option:u._getLocalizedLabels("Contains").toLowerCase()},{value:"not contains",option:u._getLocalizedLabels("DoesNotContains").toLowerCase()},{value:"greater than",option:u._getLocalizedLabels("IsGreaterThan").toLowerCase()},{value:"greater than or equal to",option:u._getLocalizedLabels("IsGreaterThanOrEqualTo").toLowerCase()},{value:"less than",option:u._getLocalizedLabels("IsLessThan").toLowerCase()},{value:"less than or equal to",option:u._getLocalizedLabels("IsLessThanOrEqualTo").toLowerCase()},];else{if(s=[],v=n(r.selectedArgs.element).attr("id")=="between"||n(r.selectedArgs.element).attr("id")=="notbetween"||r.selectedArgs.value=="between"||r.selectedArgs.value=="not between"?"4":"3",u.element.find(".cubeTreeView ").length>0)s=n.map(u.element.find(".cubeTreeView [tag*='[Measures]'] "),function(t){return{option:n(t).text(),value:n(t).attr("tag")}});else for(e=u.element.hasClass("e-pivotschemadesigner")?u.element.find(".schemaValue .pivotButton"):u.element.find(".groupingBarPivot .values .pivotButton"),e=u._schemaData&&e.length==0?n(u._schemaData.element.find(".schemaValue .pivotButton")):e,i=0;i<e.length;i++)s.push({option:n(e[i]).text(),value:n(e[i]).attr("tag").split(":")[1]});a=n(r.selectedArgs.element).hasClass("topCount")?t.buildTag("td","<input type='text' id='filterOptions' class='filterOptions' />").attr("width","80px")[0].outerHTML+t.buildTag("td","<input type='text' id='filterValue1' class='filterValues' />").attr("width","50px")[0].outerHTML+t.buildTag("td","<input type='text' id='filterMeasures' class='filterMeasures' />").attr("width","180px")[0].outerHTML:t.buildTag("td","<input type='text' id='filterMeasures' class='filterMeasures' />").attr("width","180px")[0].outerHTML+t.buildTag("td","<input type='text' id='filterOptions' class='filterOptions'/>").attr("width","180px")[0].outerHTML+t.buildTag("td.filterValuesTd","<input type='text' id='filterValue1' value='"+(r.filterInfo.length>0?o==t.Pivot.OperationalMode.ClientMode?r.filterInfo[0].values[0]:r.filterInfo[0].value1:"")+"' style='display:inline; width:190px; height:19px;' class='filterValues'/>"+(v=="4"?"<span>"+u._getLocalizedLabels("and")+" <\/span><input type='text' id='filterValue2' value='"+(r.filterInfo.length>0?o==t.Pivot.OperationalMode.ClientMode&&!t.isNullOrUndefined(r.filterInfo[0].values[1])?r.filterInfo[0].values[1]:o==t.Pivot.OperationalMode.ServerMode&&!t.isNullOrUndefined(r.filterInfo[0].value2)?r.filterInfo[0].value2:"":"")+"' style='display:inline; width:190px; height:19px;' class='filterValues'/> <\/br>":"<\/br>"))[0].outerHTML;h=t.buildTag("table.valuefilter",t.buildTag("tr",t.buildTag("td",u._getLocalizedLabels("ValueFilterLabel")).attr("colspan",r.text=="Between"?"4":"3")[0].outerHTML)[0].outerHTML+t.buildTag("tr",a)[0].outerHTML)[0].outerHTML;c=[{value:"equals",option:u._getLocalizedLabels("Equals").toLowerCase()},{value:"not equals",option:u._getLocalizedLabels("DoesNotEquals").toLowerCase()},{value:"greater than",option:u._getLocalizedLabels("IsGreaterThan").toLowerCase()},{value:"greater than or equal to",option:u._getLocalizedLabels("IsGreaterThanOrEqualTo").toLowerCase()},{value:"less than",option:u._getLocalizedLabels("IsLessThan").toLowerCase()},{value:"less than or equal to",option:u._getLocalizedLabels("IsLessThanOrEqualTo").toLowerCase()},{value:"between",option:u._getLocalizedLabels("Between").toLowerCase()},{value:"not between",option:u._getLocalizedLabels("NotBetween").toLowerCase()}]}y=t.buildTag("div",t.buildTag("button#filterDlgOKBtn.dialogOKBtn","OK")[0].outerHTML+t.buildTag("button#filterDlgCancelBtn.dialogCancelBtn","Cancel")[0].outerHTML,{float:u.model.enableRTL?"left":"right",margin:"8px 0 6px"})[0].outerHTML;u.element.find(".e-dialog").remove();n(t.buildTag("div#filterDialog.filterDialog",h+y,{opacity:"1"})).appendTo("#"+u._id);u.element.find(".filterDialog").ejDialog({enableRTL:u.model.enableRTL,enableResize:!1,cssClass:"labelValueFilterDlg",width:"auto",content:"#"+u._id,close:t.proxy(t.Pivot.closePreventPanel,u)});r.action=="valueFilterDlg"&&(u.element.find(".filterMeasures").ejDropDownList({dataSource:s,width:"180px",height:"25px",fields:{text:"option",value:"value"},create:function(){n(this.wrapper.find(".e-input")).focus(function(){n(this).blur()})}}),u._measureDDL=u.element.find(".filterMeasures").data("ejDropDownList"),l=s.length>0?s[0].value:r.filterInfo.length>0?r.filterInfo[0].measure:"",l!=""&&u._measureDDL.selectItemByValue(l));n(r.selectedArgs.element).attr("id")=="topCount"?(u.element.find("#filterOptions").ejDropDownList({dataSource:[{option:"Top",value:"topCount"},{option:"Bottom",value:"BottomCount"}],fields:{text:"option",value:"value"},value:r.filterInfo.length>0?r.filterInfo[0].operator:"topCount",create:function(){n(this.wrapper.find(".e-input")).focus(function(){n(this).blur()})}}),u.element.find("#filterValue1").ejNumericTextbox({value:r.filterInfo.length>0?parseInt(r.filterInfo[0].value1):5,minValue:1})):(p=n(r.selectedArgs.element).parent().children("li:not(#sep)").index(r.selectedArgs.element),u.element.find(".filterOptions").ejDropDownList({dataSource:c,width:"180px",height:"25px",fields:{value:"value",text:"option"},selectedIndices:[p-1],change:t.proxy(u._filterOptionChanged,u),create:function(){n(this.wrapper.find(".e-input")).focus(function(){n(this).blur()})}}),n(r.selectedArgs.element).length==0&&(w=u.element.find(".filterOptions").data("ejDropDownList"),w.selectItemByValue(r.selectedArgs.selectedValue)));u.element.find("#filterDlgOKBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(u._filterElementOkBtnClick,u)});u.element.find("#filterDlgCancelBtn").ejButton({type:t.ButtonType.Button,click:function(){n(".e-dialog").hide();t.Pivot.closePreventPanel(u)}});u.element.find(".e-titlebar").prepend(t.buildTag("div",(r.action=="valueFilterDlg"?u._getLocalizedLabels("ValueFilters")+"(":u._getLocalizedLabels("LabelFilters")+"(")+(u._selectedLevelUniqueName.indexOf(".")==-1?u._selectedLevelUniqueName:u._selectedLevelUniqueName.indexOf(".")<0?u._selectedLevelUniqueName:u._selectedLevelUniqueName.split(".")[2].replace(/\[/g,"").replace(/\]/g,""))+")",{display:"inline"}))}return f}};t.Pivot.SortOrder={None:"none",Ascending:"ascending",Descending:"descending"};t.Pivot.AdvancedFilterType={LabelFilter:"label",ValueFilter:"value"};t.Pivot.ValueFilterOptions={None:"none",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"};t.Pivot.LabelFilterOptions={None:"none",BeginsWith:"beginswith",NotBeginsWith:"notbeginswith",EndsWith:"endswith",NotEndsWith:"notendswith",Contains:"contains",NotContains:"notcontains",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"};t.Pivot.AnalysisMode={Olap:"olap",Pivot:"pivot"};t.Pivot.OperationalMode={ClientMode:"clientmode",ServerMode:"servermode"}}(jQuery,Syncfusion)});
